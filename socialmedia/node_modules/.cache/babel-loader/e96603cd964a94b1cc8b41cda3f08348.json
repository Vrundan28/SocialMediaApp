{"ast":null,"code":"var _jsxFileName = \"D:\\\\Vrundan\\\\AT_Project\\\\socialmedia\\\\src\\\\Components\\\\Messenger.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext, useRef } from 'react';\nimport NavbarHome from './NavbarHome';\nimport Conversation from './Conversation';\nimport Message from './Message';\nimport ChatOnline from './ChatOnline';\nimport './messenger.css';\nimport { Button } from '@material-ui/core';\nimport { Context } from '../context/Context';\nimport axios from 'axios';\nimport { io } from 'socket.io-client';\nimport { useLocation } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Messenger = () => {\n  _s();\n\n  const location = useLocation();\n  let urlarray = location.pathname.split('/');\n  const [conversations, setconversations] = useState([]);\n  const [currChat, setCurrChat] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newmessages, setNewMessages] = useState(\"\");\n  const [arrivalmessages, setArrivalmessages] = useState(null);\n  const [onlineUsers, setOnlineUsers] = useState(null);\n  const {\n    user,\n    dispatch\n  } = useContext(Context);\n  const scrollRef = useRef();\n  const socket = useRef();\n  const [onlinefriend, setOnlinefriend] = useState([]);\n  const [currConvo, setcurrConvo] = useState(\"\");\n  useEffect(() => {\n    socket.current = io(\"ws://localhost:8900\");\n    socket.current.on(\"getMessage\", data => {\n      setArrivalmessages({\n        sender: data.senderId,\n        text: data.text,\n        createdAt: Date.now()\n      });\n    });\n\n    if (urlarray.length == 3) {\n      let convoid = urlarray[2];\n\n      const fetchConvo = async () => {\n        const convo = await axios.get(`/conversation/convo/${convoid}`);\n        setCurrChat(convo.data);\n      };\n\n      fetchConvo();\n    }\n  }, []);\n  useEffect(() => {\n    arrivalmessages && currChat.members.includes(arrivalmessages.sender) && setMessages([...messages, arrivalmessages]);\n  }, [arrivalmessages, currChat]);\n  let onlinefriends_t = [];\n  useEffect(() => {\n    socket.current.emit(\"addUser\", user._id);\n    socket.current.on(\"getUser\", users => {\n      setOnlineUsers(users);\n      users.forEach(e => {\n        user.friends.forEach(e1 => {\n          console.log(\"e1 : \" + e1);\n\n          if (e.userId == e1) {\n            console.log(\"INSIDE e==e1\");\n            onlinefriends_t.push(e1);\n            setOnlinefriend(onlinefriends_t);\n          }\n        });\n      });\n    });\n  }, [user]);\n  useEffect(() => {\n    const friendId = conversation.members.find(m => m !== currUser._id);\n  }, [currChat]);\n  useEffect(() => {\n    const getconversation = async () => {\n      try {\n        const conver = await axios.get(`/conversation/${user._id}`);\n        setconversations(conver.data);\n      } catch (err) {\n        console.log(err.Message);\n      }\n    };\n\n    getconversation();\n  }, [user._id]);\n  useEffect(() => {\n    const getMessages = async () => {\n      try {\n        const fetchmessages = await axios.get(`/message/${currChat === null || currChat === void 0 ? void 0 : currChat._id}`);\n        setMessages(fetchmessages.data);\n      } catch (err) {\n        console.log(err.Message);\n      }\n    };\n\n    getMessages();\n  }, [currChat]);\n  useEffect(() => {\n    var _scrollRef$current;\n\n    (_scrollRef$current = scrollRef.current) === null || _scrollRef$current === void 0 ? void 0 : _scrollRef$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n  const publicFolder = \"http://localhost:5000/Images/\";\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    const currmessage = {\n      sender: user._id,\n      text: newmessages,\n      conversationId: currChat._id\n    };\n    const receiverId = currChat.members.find(member => member !== user._id);\n    socket.current.emit(\"sendMessage\", {\n      senderId: user._id,\n      receiverId,\n      text: newmessages\n    });\n\n    try {\n      const res = await axios.post(\"/message\", currmessage);\n      setMessages([...messages, res.data]);\n      setNewMessages(\"\");\n    } catch (err) {\n      console.log(err.Message);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(NavbarHome, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messenger\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chatMenu\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chatMenuWrapper\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            placeholder: \"Search User...\",\n            className: \"chatMenuInput\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 25\n          }, this), conversations.map(e => /*#__PURE__*/_jsxDEV(\"div\", {\n            onClick: () => setCurrChat(e),\n            children: /*#__PURE__*/_jsxDEV(Conversation, {\n              conversation: e,\n              currUser: user\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 153,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 29\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chatBox\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chatBoxWrapper\",\n          children: currChat ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chatBoxTop\",\n              children: messages.map(m => /*#__PURE__*/_jsxDEV(\"div\", {\n                ref: scrollRef,\n                children: /*#__PURE__*/_jsxDEV(Message, {\n                  message: m,\n                  own: m.sender === user._id,\n                  sender: m.sender\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 165,\n                  columnNumber: 29\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 164,\n                columnNumber: 29\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 162,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chatBoxBottom\",\n              children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n                placeholder: \"Write Something ....\",\n                onChange: e => setNewMessages(e.target.value),\n                value: newmessages,\n                className: \"chatMessageInput\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 171,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                color: \"primary\",\n                onClick: handleSubmit,\n                children: \" Send \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 172,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 170,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"noConversation\",\n            children: \"Start the conversation\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 30\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chatOnline\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chatOnlineWrapper\",\n          children: onlinefriend.map(e => /*#__PURE__*/_jsxDEV(ChatOnline, {\n            onlineuser: e,\n            setcurrChat: setCurrChat\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 29\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Messenger, \"LARQhmE9Q0L5pk1CRawNA1t4nZk=\", false, function () {\n  return [useLocation];\n});\n\n_c = Messenger;\nexport default Messenger;\n\nvar _c;\n\n$RefreshReg$(_c, \"Messenger\");","map":{"version":3,"sources":["D:/Vrundan/AT_Project/socialmedia/src/Components/Messenger.js"],"names":["React","useState","useEffect","useContext","useRef","NavbarHome","Conversation","Message","ChatOnline","Button","Context","axios","io","useLocation","Messenger","location","urlarray","pathname","split","conversations","setconversations","currChat","setCurrChat","messages","setMessages","newmessages","setNewMessages","arrivalmessages","setArrivalmessages","onlineUsers","setOnlineUsers","user","dispatch","scrollRef","socket","onlinefriend","setOnlinefriend","currConvo","setcurrConvo","current","on","data","sender","senderId","text","createdAt","Date","now","length","convoid","fetchConvo","convo","get","members","includes","onlinefriends_t","emit","_id","users","forEach","e","friends","e1","console","log","userId","push","friendId","conversation","find","m","currUser","getconversation","conver","err","getMessages","fetchmessages","scrollIntoView","behavior","publicFolder","handleSubmit","preventDefault","currmessage","conversationId","receiverId","member","res","post","map","target","value"],"mappings":"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","sourcesContent":["import React,{useState,useEffect,useContext,useRef} from 'react'\r\nimport NavbarHome from './NavbarHome'\r\nimport Conversation from './Conversation'\r\nimport Message from './Message'\r\nimport ChatOnline from './ChatOnline'\r\nimport './messenger.css'\r\nimport { Button } from '@material-ui/core'\r\nimport { Context } from '../context/Context'\r\nimport axios from 'axios'\r\nimport {io} from 'socket.io-client'\r\nimport {useLocation} from 'react-router-dom'\r\n\r\n\r\nconst Messenger = () => {\r\n\r\n    const location = useLocation();\r\n    let urlarray=location.pathname.split('/');\r\n    const [conversations, setconversations] = useState([])\r\n    const [currChat, setCurrChat] = useState(null)\r\n    const [messages, setMessages] = useState([])\r\n    const [newmessages,setNewMessages] = useState(\"\")\r\n    const [arrivalmessages, setArrivalmessages] = useState(null)\r\n    const [onlineUsers, setOnlineUsers] = useState(null)\r\n    const { user, dispatch } = useContext(Context);\r\n    const scrollRef = useRef()\r\n    const socket = useRef()\r\n    const [onlinefriend, setOnlinefriend] = useState([])\r\n    const [currConvo,setcurrConvo] = useState(\"\")\r\n\r\n    useEffect(() => {\r\n        socket.current = io(\"ws://localhost:8900\");\r\n        socket.current.on(\"getMessage\",(data)=>{\r\n            setArrivalmessages({\r\n                sender:data.senderId,\r\n                text:data.text,\r\n                createdAt:Date.now(),\r\n            })\r\n        })\r\n        \r\n        if(urlarray.length==3)\r\n        {\r\n            let convoid = urlarray[2];\r\n            const fetchConvo = async() => {\r\n                const convo = await axios.get(`/conversation/convo/${convoid}`);\r\n                setCurrChat(convo.data);\r\n            }\r\n            fetchConvo();\r\n        }\r\n    },[])\r\n\r\n\r\n    useEffect(()=>{\r\n        arrivalmessages \r\n        && currChat.members.includes(arrivalmessages.sender) \r\n        && setMessages([...messages,arrivalmessages])\r\n    },[arrivalmessages,currChat])\r\n\r\n\r\n    let onlinefriends_t=[]\r\n\r\n    useEffect(() => {\r\n        socket.current.emit(\"addUser\",user._id);\r\n        socket.current.on(\"getUser\",(users)=>{\r\n            setOnlineUsers(users)\r\n            users.forEach((e)=>{\r\n                user.friends.forEach((e1)=>\r\n                {\r\n                    console.log(\"e1 : \"+e1);\r\n                    if(e.userId==e1)\r\n                    {\r\n                        console.log(\"INSIDE e==e1\")\r\n                        onlinefriends_t.push(e1)\r\n                        setOnlinefriend(onlinefriends_t)\r\n                    }\r\n                })\r\n            })\r\n        })\r\n    }, [user])\r\n\r\n\r\n    useEffect(() => {\r\n        const friendId = conversation.members.find((m)=>m !== currUser._id)\r\n        \r\n    }, [currChat])\r\n\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        const getconversation = async() => {\r\n            try {\r\n                const conver = await axios.get(`/conversation/${user._id}`)\r\n                setconversations(conver.data)\r\n            } catch (err) {\r\n                console.log(err.Message)\r\n            }\r\n        }\r\n        getconversation()\r\n    }, [user._id])\r\n\r\n    useEffect(() => {\r\n        const getMessages = async() =>{\r\n            try{\r\n                const fetchmessages = await axios.get(`/message/${currChat?._id}`)\r\n                setMessages(fetchmessages.data)\r\n            }catch(err){\r\n                console.log(err.Message)\r\n            }\r\n        }\r\n        getMessages()\r\n    }, [currChat])\r\n\r\n    useEffect(() => {\r\n        scrollRef.current?.scrollIntoView({behavior:\"smooth\"})\r\n    }, [messages])\r\n\r\n\r\n    const publicFolder = \"http://localhost:5000/Images/\"\r\n    \r\n    const handleSubmit = async(e) =>{\r\n        e.preventDefault()\r\n        const currmessage={\r\n            sender : user._id,\r\n            text:newmessages,\r\n            conversationId:currChat._id\r\n        }\r\n        const receiverId = currChat.members.find(member=>member !== user._id)\r\n        socket.current.emit(\"sendMessage\",{\r\n            senderId:user._id,\r\n            receiverId,\r\n            text:newmessages,\r\n        })\r\n\r\n        try {\r\n            const res = await axios.post(\"/message\",currmessage)\r\n            setMessages([...messages,res.data])\r\n            setNewMessages(\"\")\r\n        } catch (err) {\r\n            console.log(err.Message)\r\n        }\r\n\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <NavbarHome />\r\n            <div className=\"messenger\">\r\n                <div className=\"chatMenu\">\r\n                    <div className=\"chatMenuWrapper\">\r\n                        <input placeholder=\"Search User...\" className=\"chatMenuInput\" ></input>\r\n                        {conversations.map((e)=>(\r\n                            <div onClick={()=>setCurrChat(e)}>\r\n                                <Conversation conversation={e} currUser={user} />\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n                <div className=\"chatBox\">\r\n                    <div className=\"chatBoxWrapper\">\r\n                    { currChat ? \r\n                        <>\r\n                        <div className=\"chatBoxTop\">\r\n                        {messages.map((m)=>(\r\n                            <div ref = {scrollRef}>\r\n                            <Message message={m} own={m.sender === user._id} sender = {m.sender}/>\r\n                            </div>\r\n                        ))}\r\n                            \r\n                        </div>\r\n                        <div className=\"chatBoxBottom\">\r\n                            <textarea placeholder=\"Write Something ....\" onChange={(e)=>setNewMessages(e.target.value)} value={newmessages} className=\"chatMessageInput\"></textarea>\r\n                            <Button variant=\"contained\" color=\"primary\" onClick={handleSubmit} > Send </Button>\r\n                        </div> \r\n                        </>: <span className=\"noConversation\">Start the conversation</span>\r\n                    }\r\n                    </div>\r\n\r\n                </div>\r\n                <div className=\"chatOnline\">\r\n                    <div className=\"chatOnlineWrapper\">\r\n                        {onlinefriend.map((e)=>\r\n                            <ChatOnline onlineuser={e} setcurrChat={setCurrChat}/>\r\n                        )}\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default Messenger\r\n"]},"metadata":{},"sourceType":"module"}