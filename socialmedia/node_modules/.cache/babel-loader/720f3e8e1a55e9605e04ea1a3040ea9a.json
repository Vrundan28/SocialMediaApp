{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar dom_1 = require(\"./utils/dom\");\n\nvar date_1 = require(\"./utils/date\");\n\nvar locales_1 = require(\"./locales\"); // all realtime timer\n\n\nvar TIMER_POOL = {};\n/**\r\n * clear a timer from pool\r\n * @param tid\r\n */\n\nvar clear = function (tid) {\n  clearTimeout(tid);\n  delete TIMER_POOL[tid];\n}; // run with timer(setTimeout)\n\n\nfunction run(node, date, localeFunc, opts) {\n  // clear the node's exist timer\n  clear(dom_1.getTimerId(node));\n  var relativeDate = opts.relativeDate,\n      minInterval = opts.minInterval; // get diff seconds\n\n  var diff = date_1.diffSec(date, relativeDate); // render\n\n  node.innerText = date_1.formatDiff(diff, localeFunc);\n  var tid = setTimeout(function () {\n    run(node, date, localeFunc, opts);\n  }, Math.max(date_1.nextInterval(diff), minInterval || 1) * 1000, 0x7fffffff); // there is no need to save node in object. Just save the key\n\n  TIMER_POOL[tid] = 0;\n  dom_1.setTimerId(node, tid);\n} // 取消一个 node 的实时渲染\n\n\nfunction cancel(node) {\n  // cancel one\n  if (node) clear(dom_1.getTimerId(node)); // cancel all\n  // @ts-ignore\n  else Object.keys(TIMER_POOL).forEach(clear);\n}\n\nexports.cancel = cancel;\n/**\r\n * render a dom realtime\r\n * @param nodes\r\n * @param locale\r\n * @param opts\r\n */\n\nfunction render(nodes, locale, opts) {\n  // by .length\n  var nodeList = 'length' in nodes ? nodes : [nodes];\n  nodeList.forEach(function (node) {\n    run(node, dom_1.getDateAttribute(node), locales_1.getLocale(locale), opts || {});\n  });\n  return nodeList;\n}\n\nexports.render = render;","map":{"version":3,"sources":["realtime.ts"],"names":[],"mappings":";;;;;;AAAA,IAAA,KAAA,GAAA,OAAA,CAAA,aAAA,CAAA;;AACA,IAAA,MAAA,GAAA,OAAA,CAAA,cAAA,CAAA;;AACA,IAAA,SAAA,GAAA,OAAA,CAAA,WAAA,CAAA,C,CAGA;;;AACA,IAAM,UAAU,GAAc,EAA9B;AAEA;;;AAGG;;AACH,IAAM,KAAK,GAAG,UAAC,GAAD,EAAY;AACxB,EAAA,YAAY,CAAC,GAAD,CAAZ;AACA,SAAO,UAAU,CAAC,GAAD,CAAjB;AACD,CAHD,C,CAKA;;;AACA,SAAS,GAAT,CAAa,IAAb,EAAgC,IAAhC,EAA8C,UAA9C,EAAsE,IAAtE,EAAgF;AAC9E;AACA,EAAA,KAAK,CAAC,KAAA,CAAA,UAAA,CAAW,IAAX,CAAD,CAAL;AAEQ,MAAA,YAAA,GAAA,IAAA,CAAA,YAAA;AAAA,MAAc,WAAA,GAAA,IAAA,CAAA,WAAd,CAJsE,CAM9E;;AACA,MAAM,IAAI,GAAG,MAAA,CAAA,OAAA,CAAQ,IAAR,EAAc,YAAd,CAAb,CAP8E,CAQ9E;;AACA,EAAA,IAAI,CAAC,SAAL,GAAiB,MAAA,CAAA,UAAA,CAAW,IAAX,EAAiB,UAAjB,CAAjB;AAEA,MAAM,GAAG,GAAI,UAAU,CACrB,YAAA;AACE,IAAA,GAAG,CAAC,IAAD,EAAO,IAAP,EAAa,UAAb,EAAyB,IAAzB,CAAH;AACD,GAHoB,EAIrB,IAAI,CAAC,GAAL,CAAS,MAAA,CAAA,YAAA,CAAa,IAAb,CAAT,EAA6B,WAAW,IAAI,CAA5C,IAAiD,IAJ5B,EAKrB,UALqB,CAAvB,CAX8E,CAmB9E;;AACA,EAAA,UAAU,CAAC,GAAD,CAAV,GAAkB,CAAlB;AACA,EAAA,KAAA,CAAA,UAAA,CAAW,IAAX,EAAiB,GAAjB;AACD,C,CAED;;;AACA,SAAgB,MAAhB,CAAuB,IAAvB,EAAyC;AACvC;AACA,MAAI,IAAJ,EAAU,KAAK,CAAC,KAAA,CAAA,UAAA,CAAW,IAAX,CAAD,CAAL,CAAV,CACA;AACA;AAFA,OAGK,MAAM,CAAC,IAAP,CAAY,UAAZ,EAAwB,OAAxB,CAAgC,KAAhC;AACN;;AAND,OAAA,CAAA,MAAA,GAAA,MAAA;AAQA;;;;;AAKG;;AACH,SAAgB,MAAhB,CAAuB,KAAvB,EAAsD,MAAtD,EAAuE,IAAvE,EAAkF;AAChF;AACA,MAAM,QAAQ,GAAa,YAAY,KAAZ,GAAoB,KAApB,GAA8B,CAAC,KAAD,CAAzD;AAEA,EAAA,QAAQ,CAAC,OAAT,CAAiB,UAAC,IAAD,EAAkB;AACjC,IAAA,GAAG,CAAC,IAAD,EAAO,KAAA,CAAA,gBAAA,CAAiB,IAAjB,CAAP,EAA+B,SAAA,CAAA,SAAA,CAAU,MAAV,CAA/B,EAAkD,IAAI,IAAI,EAA1D,CAAH;AACD,GAFD;AAIA,SAAO,QAAP;AACD;;AATD,OAAA,CAAA,MAAA,GAAA,MAAA","sourceRoot":"src/","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar dom_1 = require(\"./utils/dom\");\r\nvar date_1 = require(\"./utils/date\");\r\nvar locales_1 = require(\"./locales\");\r\n// all realtime timer\r\nvar TIMER_POOL = {};\r\n/**\r\n * clear a timer from pool\r\n * @param tid\r\n */\r\nvar clear = function (tid) {\r\n    clearTimeout(tid);\r\n    delete TIMER_POOL[tid];\r\n};\r\n// run with timer(setTimeout)\r\nfunction run(node, date, localeFunc, opts) {\r\n    // clear the node's exist timer\r\n    clear(dom_1.getTimerId(node));\r\n    var relativeDate = opts.relativeDate, minInterval = opts.minInterval;\r\n    // get diff seconds\r\n    var diff = date_1.diffSec(date, relativeDate);\r\n    // render\r\n    node.innerText = date_1.formatDiff(diff, localeFunc);\r\n    var tid = setTimeout(function () {\r\n        run(node, date, localeFunc, opts);\r\n    }, Math.max(date_1.nextInterval(diff), minInterval || 1) * 1000, 0x7fffffff);\r\n    // there is no need to save node in object. Just save the key\r\n    TIMER_POOL[tid] = 0;\r\n    dom_1.setTimerId(node, tid);\r\n}\r\n// 取消一个 node 的实时渲染\r\nfunction cancel(node) {\r\n    // cancel one\r\n    if (node)\r\n        clear(dom_1.getTimerId(node));\r\n    // cancel all\r\n    // @ts-ignore\r\n    else\r\n        Object.keys(TIMER_POOL).forEach(clear);\r\n}\r\nexports.cancel = cancel;\r\n/**\r\n * render a dom realtime\r\n * @param nodes\r\n * @param locale\r\n * @param opts\r\n */\r\nfunction render(nodes, locale, opts) {\r\n    // by .length\r\n    var nodeList = 'length' in nodes ? nodes : [nodes];\r\n    nodeList.forEach(function (node) {\r\n        run(node, dom_1.getDateAttribute(node), locales_1.getLocale(locale), opts || {});\r\n    });\r\n    return nodeList;\r\n}\r\nexports.render = render;\r\n//# sourceMappingURL=realtime.js.map"]},"metadata":{},"sourceType":"script"}